# Set Variables
$GUID = "381b4222-f694-41f0-9685-ff5bb260aaaa"
$LIDSUBGUID = '4f971e89-eebd-4455-a8de-9e59040e7347'
$LIDCLOSEGUID = '5ca83367-6e45-459f-a27b-476b1d01c936'
$POWERGUID = '7648efa3-dd9c-4e3e-b566-50f929386280'
$SLEEPGUID = '96996bc0-ad50-47ec-923b-6f41874dd9eb'
$LIDSUBGROUPGUID = "4f971e89-eebd-4455-a8de-9e59040e7347"
$LIDPOWERSETTINGGUID = "5ca83367-6e45-459f-a27b-476b1d01c936"
$DESKTOPBACKGROUNDSUBGROUPGUID = "0d7dbae2-4294-402a-ba8e-26777e8488cd"
$DESKTOPBACKGROUNDPOWERSETTINGGUID = "309dce9b-bef4-4119-9921-a851fb12f0f4"
$WIRELESSSUBGROUPGUID = "19cbb8fa-5279-450e-9fac-8a3d5fedd0c1"
$WIRELESSPOWERGUID = "12bbebe6-58d6-4636-95bb-3217ef867c1a"
$SLEEPSUBGROUPGUID = "238c9fa8-0aad-41ed-83f4-97be242c8f20"
$SLEEPPOWERGUID = "29f6c1db-86da-48c5-9fdb-f2b67b1f44da"
$HYBRIDSLEEPPOWERGUID = "94ac6d29-73ce-41a6-809f-6363ba21b47e"
$HIBERNATEAFTERPOWERGUID = "9d7815a6-7ee4-497e-8888-515a05f02364"
$ALLOWWAKETIMERSPOWERGUID = "bd3b718a-0680-4d9d-8ab2-e1d2b4ac806d"
$USBSUBGROUPGUID = "2a737441-1930-4402-8d77-b2bebba308a3"
$USBPOWERGUID = "48e6b7a6-50f5-4782-a5d4-53bb8f07e226"
$INTELSUBGROUPGUID = "44f3beca-a7c0-460e-9df2-bb8b99e0cba6"
$INTELPOWERGUID = "3619c3f2-afb2-4afc-b0e9-e7fef372de36"
$LIDSUBGROUPGUID = "4f971e89-eebd-4455-a8de-9e59040e7347"
$STARTMENUPOWERGUID = "a7066653-8d6c-40a8-910e-a1f54b84c7e5"
$PCISUBGROUPGUID = "501a4d13-42af-4429-9fd1-a8218c268e20"
$PCIPOWERGUID = "ee12f906-d277-404b-b6da-e5fa1a576df5"

# Options
$DONOTHING = 0
$SLEEP = 1
$HIBERNATE = 2
$SHUTDOWN = 3

# Switches
$AC = '-setacvalueindex'
$DC = '-setdcvalueindex'

# Find The Balanced Power Scheme GUID
$GUIDREGEX = "(\{){0,1}[a-fA-F0-9]{8}-([a-fA-F0-9]{4}-){3}[a-fA-F0-9]{12}(\}){0,1}"
[regex]$REGEX = $GUIDREGEX
$BALANCEDGUID = ($REGEX.Matches((PowerCfg /LIST | WHERE {$_ -like "*Balanced*"}).ToString())).Value

# Copy The "Balanced" Scheme
POWERCFG -DUPLICATESCHEME $BALANCEDGUID $GUID

# Change The Name Of The Copied Scheme
POWERCFG -CHANGENAME $GUID "My Power Scheme"

# Set The New Scheme As The Active Scheme
POWERCFG -SETACTIVE $GUID

# Change The Preferred Scheme In The Windows Registry
$REGGUID = "{025A5937-A6BE-4686-A844-36FE4BEC8B6D}"
$CURRENTPREFERREDSCHEME = Get-ItemProperty -Path Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\explorer\ControlPanel\NameSpace\$REGGUID -Name PreferredPlan 
IF ($CURRENTPREFERREDSCHEME.PreferredPlan -ne $GUID)
{
	Set-ItemProperty -Path Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\explorer\ControlPanel\NameSpace\$REGGUID -Name PreferredPlan -Value $guid
}

POWERCFG $AC $GUID $LIDSUBGUID $LIDCLOSEGUID $DONOTHING
POWERCFG $AC $GUID $LIDSUBGUID $POWERGUID	 $SHUTDOWN
POWERCFG $AC $GUID $LIDSUBGUID $SLEEPGUID	 $SLEEP

POWERCFG $DC $GUID $LIDSUBGUID $LIDCLOSEGUID $SLEEP
POWERCFG $DC $GUID $LIDSUBGUID $POWERGUID	 $SHUTDOWN
POWERCFG $DC $GUID $LIDSUBGUID $SLEEPGUID	 $SLEEP

POWERCFG $AC $GUID $DESKTOPBACKGROUNDSUBGROUPGUID $DESKTOPBACKGROUNDPOWERSETTINGGUID $DONOTHING
POWERCFG $DC $GUID $DESKTOPBACKGROUNDSUBGROUPGUID $DESKTOPBACKGROUNDPOWERSETTINGGUID $DONOTHING

POWERCFG $AC $GUID $WIRELESSSUBGROUPGUID $WIRELESSPOWERGUID $DONOTHING
POWERCFG $DC $GUID $WIRELESSSUBGROUPGUID $WIRELESSPOWERGUID $DONOTHING

POWERCFG $AC $GUID $SLEEPSUBGROUPGUID $HYBRIDSLEEPPOWERGUID $DONOTHING
POWERCFG $DC $GUID $SLEEPSUBGROUPGUID $HYBRIDSLEEPPOWERGUID $SLEEP

POWERCFG $AC $GUID $SLEEPSUBGROUPGUID $HIBERNATEAFTERPOWERGUID $DONOTHING
POWERCFG $DC $GUID $SLEEPSUBGROUPGUID $HIBERNATEAFTERPOWERGUID $DONOTHING

POWERCFG $AC $GUID $SLEEPSUBGROUPGUID $ALLOWWAKETIMERSPOWERGUID $HIBERNATE
POWERCFG $DC $GUID $SLEEPSUBGROUPGUID $ALLOWWAKETIMERSPOWERGUID $HIBERNATE

POWERCFG $AC $GUID $USBSUBGROUPGUID $USBPOWERGUID $DONOTHING
POWERCFG $DC $GUID $USBSUBGROUPGUID $USBPOWERGUID $DONOTHING

POWERCFG $AC $GUID $INTELSUBGROUPGUID $INTELPOWERGUID $HIBERNATE
POWERCFG $DC $GUID $INTELSUBGROUPGUID $INTELPOWERGUID $SLEEP

POWERCFG $AC $GUID $LIDSUBGROUPGUID $STARTMENUPOWERGUID $DONOTHING
POWERCFG $DC $GUID $LIDSUBGROUPGUID $STARTMENUPOWERGUID $DONOTHING

POWERCFG $AC $GUID $PCISUBGROUPGUID $PCIPOWERGUID $DONOTHING
POWERCFG $DC $GUID $PCISUBGROUPGUID $PCIPOWERGUID $HIBERNATE
